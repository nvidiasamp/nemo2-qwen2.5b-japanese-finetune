# LLM-JP æ•°æ®å¤„ç†æŒ‡å— - NeMo 2.0 ç‰ˆæœ¬

## æ¦‚è¿°

åŸºäºç”¨æˆ·åœ¨ NeMo 1.0 ä¸­éªŒè¯çš„æˆåŠŸæ–¹æ³•ï¼Œé€‚é… NeMo 2.0 çš„æ•°æ®å¤„ç†æµç¨‹ã€‚ä½¿ç”¨Dockerå®¹å™¨ç¯å¢ƒç¡®ä¿ä¸€è‡´æ€§å’Œå¯é‡å¤æ€§ã€‚

### æ ¸å¿ƒæ”¹è¿›
- **åˆ†è¯å™¨é€‚é…**ï¼šä» `Llama-3.1-8B` æ”¹ä¸º `Qwen/Qwen2.5-0.5B`
- **å®¹å™¨åŒ–å¤„ç†**ï¼šåŸºäºNeMo 25.04å®¹å™¨ç¯å¢ƒ
- **æ™ºèƒ½åˆå¹¶**ï¼šè‡ªåŠ¨åˆå¹¶è®­ç»ƒæ–‡ä»¶é¿å…è·¯å¾„é—®é¢˜
- **å®æ—¶ç›‘æ§**ï¼šæä¾›è¿›åº¦è·Ÿè¸ªå·¥å…·

## æ–‡ä»¶è¯´æ˜

### æ ¸å¿ƒè„šæœ¬
- **`process_data_in_container_fixed.sh`** - ä¸»è¦æ•°æ®å¤„ç†è„šæœ¬
  - åœ¨Dockerå®¹å™¨å†…æ‰§è¡Œ
  - è‡ªåŠ¨ä¸‹è½½LLM-JPæ•°æ®ï¼ˆå¦‚éœ€è¦ï¼‰
  - åˆå¹¶è®­ç»ƒæ–‡ä»¶å¹¶è½¬æ¢ä¸ºNeMoæ ¼å¼
  - ä½¿ç”¨Qwen/Qwen2.5-0.5Båˆ†è¯å™¨

### ç›‘æ§å·¥å…·
- **`monitor_progress.sh`** - è¿›åº¦ç›‘æ§è„šæœ¬
  - æ£€æŸ¥Dockerå®¹å™¨çŠ¶æ€
  - æ˜¾ç¤ºæ–‡ä»¶ç”Ÿæˆè¿›åº¦
  - æä¾›å®Œæˆåº¦ä¼°ç®—

### æ–‡æ¡£
- **`README.md`** - æœ¬æ–‡æ¡£

## å¿«é€Ÿä½¿ç”¨

### æ–¹æ³•1ï¼šæ‰‹åŠ¨Dockeræ‰§è¡Œï¼ˆæ¨èï¼‰
```bash
# ä½¿ç”¨ç°æœ‰NeMo 25.04å®¹å™¨
docker run \
    --gpus all -it --rm \
    --shm-size=16g \
    --ulimit memlock=-1 --ulimit stack=67108864 \
    -v "/home/cho/workspace/workshop-25-08-02:/workspace" \
    -w "/workspace" \
    nvcr.io/nvidia/nemo:25.04 \
    bash -c "chmod +x /workspace/scripts/data_processing/process_data_in_container_fixed.sh && /workspace/scripts/data_processing/process_data_in_container_fixed.sh"
```

### æ–¹æ³•2ï¼šè¿›åº¦ç›‘æ§
```bash
# ä¸€æ¬¡æ€§æ£€æŸ¥
./scripts/data_processing/monitor_progress.sh

# å®æ—¶ç›‘æ§ï¼ˆæ¯30ç§’æ›´æ–°ï¼‰
watch -n 30 ./scripts/data_processing/monitor_progress.sh
```

## é¢„æœŸè¾“å‡º

### æ–‡ä»¶ç»“æ„
```
data/llm_jp_wiki/
â”œâ”€â”€ raw/ja_wiki/                    # åŸå§‹æ•°æ®ï¼ˆ12GBï¼‰
â”‚   â”œâ”€â”€ train_0.jsonl
â”‚   â”œâ”€â”€ train_1.jsonl
â”‚   â”œâ”€â”€ ...
â”‚   â”œâ”€â”€ train_13.jsonl
â”‚   â”œâ”€â”€ train_merged.jsonl          # åˆå¹¶çš„è®­ç»ƒæ–‡ä»¶ï¼ˆ6GBï¼‰
â”‚   â””â”€â”€ validation_0.jsonl
â””â”€â”€ nemo_binary/                    # NeMo æ ¼å¼æ•°æ®
    â”œâ”€â”€ ja_wiki_train_text_document.bin    (~500-800MB)
    â”œâ”€â”€ ja_wiki_train_text_document.idx
    â”œâ”€â”€ ja_wiki_val_text_document.bin      (~10-20MB)
    â””â”€â”€ ja_wiki_val_text_document.idx
```

### å¤„ç†æ—¶é—´
- **æ•°æ®ä¸‹è½½**ï¼šå·²å®Œæˆï¼ˆå¦‚æœåˆæ¬¡è¿è¡Œéœ€30-60åˆ†é’Ÿï¼‰
- **æ•°æ®åˆå¹¶**ï¼š5-10åˆ†é’Ÿ
- **NeMoè½¬æ¢**ï¼š1-2å°æ—¶
- **æ€»è®¡**ï¼š2-3å°æ—¶

### æŠ€æœ¯é…ç½®
- **å®¹å™¨**ï¼šnvcr.io/nvidia/nemo:25.04
- **åˆ†è¯å™¨**ï¼šQwen/Qwen2.5-0.5B
- **è¾“å‡ºæ ¼å¼**ï¼šmmap (.bin/.idx)
- **å·¥ä½œçº¿ç¨‹**ï¼šè®­ç»ƒæ•°æ®4ä¸ªï¼ŒéªŒè¯æ•°æ®2ä¸ª

## ä¸NeMo 1.0çš„å…¼å®¹æ€§

æ­¤æ–¹æ³•100%åŸºäºç”¨æˆ·åœ¨NeMo 1.0ä¸­éªŒè¯çš„æˆåŠŸæµç¨‹ï¼Œåªéœ€è¦ä¸€ä¸ªå…³é”®è°ƒæ•´ï¼š

```bash
# å”¯ä¸€æ”¹åŠ¨
--tokenizer-type="meta-llama/Llama-3.1-8B"  # NeMo 1.0
â†“
--tokenizer-type="Qwen/Qwen2.5-0.5B"        # NeMo 2.0é€‚é…
```

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**1. å®¹å™¨å¯åŠ¨å¤±è´¥**
```bash
# æ£€æŸ¥Dockerå’ŒGPU
docker --version
nvidia-smi
```

**2. æ•°æ®å¤„ç†ä¸­æ–­**
```bash
# æŸ¥çœ‹ç›‘æ§çŠ¶æ€
./scripts/data_processing/monitor_progress.sh

# é‡æ–°å¯åŠ¨å¤„ç†ï¼ˆä¼šè·³è¿‡å·²å­˜åœ¨çš„æ–‡ä»¶ï¼‰
# é‡æ–°è¿è¡ŒDockerå‘½ä»¤å³å¯
```

**3. è¾“å‡ºæ–‡ä»¶ä¸å®Œæ•´**
- è„šæœ¬ä¼šè‡ªåŠ¨éªŒè¯æ‰€æœ‰4ä¸ªå¿…éœ€æ–‡ä»¶
- å¦‚æœå¤±è´¥ï¼Œä¼šæ˜¾ç¤ºè¯¦ç»†é”™è¯¯ä¿¡æ¯
- é‡æ–°è¿è¡Œä¼šä»ä¸­æ–­ç‚¹ç»§ç»­

### æ—¥å¿—çº§åˆ«
- ğŸŸ¢ **[INFO]** - æ­£å¸¸è¿›åº¦ä¿¡æ¯
- ğŸ”µ **[STEP]** - ä¸»è¦å¤„ç†æ­¥éª¤
- ğŸŸ¡ **[WARN]** - è­¦å‘Šä¿¡æ¯

## å®ŒæˆéªŒè¯

å¤„ç†æˆåŠŸå®Œæˆåï¼Œæ‚¨å°†çœ‹åˆ°ï¼š
```
âœ… æ•°æ®å¤„ç†å®Œæˆï¼

ğŸ“ ç”Ÿæˆçš„æ–‡ä»¶ï¼š
ja_wiki_train_text_document.bin - 512M
ja_wiki_train_text_document.idx - 4.0K
ja_wiki_val_text_document.bin - 15M
ja_wiki_val_text_document.idx - 1.0K

ğŸ“Š æ–‡ä»¶å¤§å°ç»Ÿè®¡ï¼š
è®­ç»ƒæ•°æ®: 512M
éªŒè¯æ•°æ®: 15M
æ€»è®¡: 527M

ğŸš€ ä¸‹ä¸€æ­¥ï¼šæ‚¨å¯ä»¥å¼€å§‹ä»»åŠ¡7 - å®ç°PEFT-LoRAå¾®è°ƒè„šæœ¬
```

## ä¸‹ä¸€æ­¥é›†æˆ

ç”Ÿæˆçš„NeMoäºŒè¿›åˆ¶æ–‡ä»¶å¯ç›´æ¥ç”¨äºï¼š
- **ä»»åŠ¡7**ï¼šPEFT-LoRAå¾®è°ƒè„šæœ¬
- **ä»»åŠ¡4**ï¼šæ—¥è¯­æŒç»­å­¦ä¹ è®­ç»ƒ
- **ä»»åŠ¡6**ï¼šæŒç»­å­¦ä¹ æ‰§è¡Œ

é…ç½®æ–‡ä»¶ä¸­çš„æ•°æ®è·¯å¾„åº”è¯¥è®¾ç½®ä¸ºï¼š
```yaml
data:
  train_path: ./data/llm_jp_wiki/nemo_binary/ja_wiki_train_text_document
  validation_path: ./data/llm_jp_wiki/nemo_binary/ja_wiki_val_text_document
```

---

**é¡¹ç›®çŠ¶æ€**ï¼šæ­¤æ•°æ®å¤„ç†æµç¨‹åŸºäºç”¨æˆ·åœ¨ç”Ÿäº§ç¯å¢ƒä¸­éªŒè¯çš„æˆåŠŸæ–¹æ³•ï¼Œå…·æœ‰å¾ˆé«˜çš„å¯é æ€§å’Œç¨³å®šæ€§ã€‚